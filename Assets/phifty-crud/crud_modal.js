// Generated by CoffeeScript 1.9.3

/*

CRUDModal.openFromBtn depends on data attributes:

- data-modal-title: modal title
- data-modal-side: display as a side modal?
- data-modal-size: modal size size
- data-edit-url: the url of the content to be embedded.

This method reads the attributes from button element and open the CRUD form in
a modal.

modalConfig will be used when you need to define modal options.
 */

(function() {
  window.CRUDModal = {};

  CRUDModal.openFromBtn = function($btn, modalConfig) {
    var id, side, size, title, ui;
    id = $btn.data("record-id");
    title = $btn.data("modal-title") || "Untitled";
    size = $btn.data("modal-size");
    side = $btn.data("modal-side");
    ui = ModalManager.create({
      title: title,
      side: side,
      size: size,
      ajax: {
        url: $btn.data("edit-url"),
        args: {
          _submit_btn: false,
          _close_btn: false,
          id: id
        }
      },
      controls: [
        {
          label: 'Save',
          primary: true,
          onClick: function(e, ui) {
            return ui.body.find("form").submit();
          }
        }
      ]
    });
    ui.dialog.on("dialog.ajax.done", function(e, ui) {
      var $result, a, form;
      form = ui.body.find("form").get(0);
      $result = $('<div/>').addClass('action-result-container');
      $(form).before($result);
      a = Action.form(form, {
        status: true,
        clear: true,
        onSuccess: function(resp) {
          return setTimeout((function() {
            return ui.dialog.foldableModal('close');
          }), 1000);
        }
      });
      return a.plug(ActionMsgbox, {
        container: $result,
        fadeOut: false
      });
    });
    ui.dialog.foldableModal(modalConfig || 'show');
    return ui;
  };

}).call(this);
